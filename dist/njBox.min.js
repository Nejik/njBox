!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("njBox",[],e):"object"==typeof exports?exports.njBox=e():t.njBox=e()}(this,function(){return function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}();i(1);var d=i(2),h=n(d),u=i(3),f=i(4),m=n(f),p=function(t,e,i,n){var d=t.jQuery||t.$||m.default,f=function(h){function f(t,e){if(s(this,f),!arguments.length)return console.error("njBox, arguments not passed."),a(o);var i;!e&&t?i=d.isPlainObject(t)?t:{elem:t}:(i=e,i.elem=t);var o=a(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,i));return o._i(),o}return r(f,h),c(f,[{key:"_i",value:function(){this.on("init",function(){this._defaults=f.defaults,this._templates=f.templates,this._text=f.text,f.g||(f.g=(0,u.getDefaultInfo)()),this._handlers={}}),this.on("options_set",function(){var t=this,e=t.o;this._g.insertWrap=!0;var e=this.o=d.extend({},this._defaults,e);if(e.jquery&&(d=e.jquery),this.$=d,e.elem){var i=function(e){var i=d(e);return i.length?(i.length>1&&(t._e("njBox found more than one item for current o.elem ("+e+"). First was used."),i=d(i[0])),i[0].njBox?(t._e("njBox, already inited on this element ("+e+")"),i):(i[0].njBox=t,i)):(t._e("njBox, wrong selector or element in o.elem ("+e+")"),i)}(e.elem),o=this._g.optionsGathered=this._gatherData(i);this._g.els=i,this._cb("options_gathered",o,i[0]),d.extend(this.o,o)}for(var n in f.addons)f.addons.hasOwnProperty(n)&&this["_"+n+"_init"]();this._g.animation=this._calculateAnimations()}),this.on("dom_create",function(){this.dom=this._createDom(),this.dom.insertInto=this.dom.items,(this._g.containerIsBody=this.dom.container[0]===this.dom.body[0])||("static"===this.dom.container.css("position")&&this.dom.container.addClass("njb-relative"),"fixed"===o.layout&&(o.layout="absolute",this.dom.wrap.addClass("njb-absolute")))}),this.on("item_normalized",function(t,i){t.type||(t.type=this._type(t.content)),t.el=i.el||e}),this.on("item_create",function(t,e){t.content=t.content||this._text._missedContent,t.dom=this._createItemDom(t),t.toInsert=t.dom.modalOuter,this._insertItemContent({item:t,delayed:this.o.delayed})}),this.on("inited",function(){this._addClickHandler()}),this.on("show_prepare",function(){var t=this.state.clickedEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var e=this.dom.wrap;this.state.focused||(this.state.focused=n.activeElement),delete this.returnValue,"hide"===this.o.scrollbar&&this._scrollbar("hide"),this.o.backdrop&&this._backdrop("show"),this._addListeners(),this._uiUpdate(),this._cb("dom_insert"),this._g.insertWrap&&this.dom.container.append(e),this._drawItem({item:this._getActive(),container:this.dom.insertInto,prepend:!1}),e[0].style.display="none",e[0].clientHeight,e[0].style.display="block",this.position(),this._cb("dom_inserted")}),this.on("animation_show",function(){var t=this,e=t.o,o=t._getActive().dom.modal,n=this._g.animation.show,s=this._g.animation.showDur;this.dom.wrap[0].clientHeight,this.dom.wrap.addClass("njb-wrap--visible"),e.animclass&&o.addClass(e.animclass),o.attr("open",""),n?(o.addClass(n),t._g.shownCb=i(function(){"show"===t.state.status&&t._shownCb()},s)):t._shownCb()}),this.on("shown",function(){var t=this.o,e=this._getActive().dom.modal;t.animclass&&e.removeClass(t.animclass),this._g.animation.show&&e.removeClass(this._g.animation.show),e[0].clientHeight,this._set_focus(this.items[this.state.active])}),this.on("hide_prepare",function(){this.state.focused&&this.state.focused.focus(),this._backdrop("hide"),this._removeListeners()}),this.on("animation_hide",function(){var t=this,e=t.o,o=t._getActive().dom.modal,n=this._g.animation.show,s=this._g.animation.hide,a=this._g.animation.hideDur;o[0].removeAttribute("open"),this.dom.wrap.removeClass("njb-wrap--visible"),s?(e.animclass&&o.addClass(e.animclass),s===n&&o.addClass("njb-anim-reverse"),o.addClass(s),t._g.hiddenCb=i(function(){"hide"===t.state.status&&t._hiddenCb()},a)):t._hiddenCb()}),this.on("clear",function(){var t=this.o,e=this._getActive().dom.modal,i=this._g.animation.show,o=this._g.animation.hide;t.animclass&&e.removeClass(t.animclass),o===i&&e.removeClass("njb-anim-reverse"),o&&e.removeClass(o),e[0].clientHeight,this._scrollbar("show"),this._g.insertWrap&&this.dom.wrap&&this.dom.wrap.length&&this.dom.wrap[0].parentNode.removeChild(this.dom.wrap[0]),this._removeSelectorItemsElement(),this.dom.items&&this.dom.items.length&&function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.dom.items[0]);for(var n=0,s=this.items.length;n<s;n++)this.items[n].dom.modalOuter[0].style.cssText=""}),this.on("hide",function(){this.state.okCb||this.state.cancelCb||(this.returnValue=this._getReturnValue(),this._cb("cancel",this.returnValue))}),this.on("hidden",function(){this.o.focusprevious&&this._focusPreviousModal()}),this.on("position",function(){var t=this.state.dimensions=this._getDimensions();if("absolute"===this.o.layout){var e=t.container.scrollTop,i=t.container.scrollLeft;e<=t.container.scrollTopMax&&this.dom.wrap.css({top:e+"px",left:i+"px"}),this.dom.backdrop.css({width:"auto",height:"auto"}),this.dom.backdrop[0].clientHeight,this.dom.backdrop.css({width:t.container.scrollWidth+"px",height:t.container.scrollHeight+"px"})}this._setMaxHeight(this._getActive())}),this.on("destroy",function(){this._removeClickHandler(),this.dom.container.removeClass("njb-relative")}),this.on("destroyed",function(){this._defaults=this._handlers=this._templates=this._text=this.$={}})}},{key:"update",value:function(){return this.state.arguments.update=arguments,this.items=this._createItems(this._g.rawItems),this._addClickHandler(),this}},{key:"_gatherData",value:function(t){var e=this.o,i=d(t),o={$elem:i};if(!i.length)return o;var n=d.extend({},i.data());if(n.njbOptions)try{o=d.parseJSON(n.njbOptions),delete n.njbOptions}catch(t){return void this._e("njBox, fail to parse options from njb-options")}if("a"===i[0].tagName.toLowerCase()){var s=i.attr("href");s&&"#"!==s&&"#!"!==s&&!/^(?:javascript)/i.test(s)&&(o.content=s)}if(e.titleattr){var a=i.attr(e.titleattr);a&&(o.title=a)}d.extend(o,function(t){var e={};for(var i in t)if(t.hasOwnProperty(i)&&/^njb[A-Z]+/.test(i)){var o=i.match(/^njb(.*)/)[1],n=o.charAt(0).toLowerCase()+o.slice(1);e[n]=t[i]}return e}(n));for(var r in o)o.hasOwnProperty(r)&&(o[r]=function(t){var e=/\s/.test(t),i=e?t:parseFloat(t);return"true"===t||"false"!==t&&(isNaN(i)?t:i)}(o[r]));return o}},{key:"_createDom",value:function(){var e=this.o,i={document:d(n),window:d(t),html:d(n.documentElement),body:d(n.body)};return i.container=d(e.container),i.container.length||(this._e("njBox, can't find container element. (we use body instead)"),i.container=i.body),i.wrap=this._createEl("wrap"),e.class&&i.wrap.addClass(e.class),i.wrap[0].tabIndex=-1,i.wrap[0].njBox=this,e.zindex&&i.wrap.css("zIndex",e.zindex),!0===e.autoheight?i.wrap.addClass("njb-wrap--autoheight-true"):"image"===e.autoheight&&i.wrap.addClass("njb-wrap--autoheight-image"),i.items=i.wrap.find(".njb-items"),i.ui=this._createEl("ui"),i.wrap.append(i.ui),i.title=this._createEl("title"),i.ui.append(i.title),"outside"===e.close&&(i.close=this._createEl("close"),i.close.attr("title",this._text.close).attr("aria-label",this._text.close),i.ui.append(i.close)),i.focusCatchBefore=this._createEl("focusCatcher"),i.wrap.prepend(i.focusCatchBefore),i.focusCatchAfter=this._createEl("focusCatcher"),i.wrap.append(i.focusCatchAfter),i}},{key:"_createEl",value:function(t){var e=this._templates[t],i=d(e);return i.length||console.warn("njBox, smth wrong with template - "+t+"."),i}},{key:"_calculateAnimations",value:function(){var t,e,i,o,s,a=this.o,r=!1;a.anim&&(s=a.anim.split(" "),t=s[0],e=s[1]?s[1]:s[0]),a.duration&&(a.duration=a.duration.toString(),s=a.duration.split(" "),i=s[0],o=s[1]?s[1]:s[0]);var l=n.createElement("div");return l.style.cssText="visibility: hidden; position: absolute;",i&&"auto"!==i||!t?i=parseInt(i)||0:(l.className=(a.animclass||"")+" "+t,n.body.appendChild(l),r=!0,i=this._getAnimTime(l)),o&&"auto"!==o||!e?o=parseInt(o)||0:(l.className=(a.animclass||"")+" "+e,r||(n.body.appendChild(l),r=!0),o=this._getAnimTime(l)),r&&n.body.removeChild(l),{show:t||"",hide:e||"",showDur:i||0,hideDur:o||0}}},{key:"_getAnimTime",value:function(t,i){function o(t,i){var o,n,s,a,r=d(t),t=r[0],l=[];if(!r.length)return 0;if(!i)return 0;o=r.css(i+"Duration"),s=r.css(i+"Delay"),o&&o!==e||(o="0s"),n=o.split(", ");for(var c=0,h=n.length;c<h;c++)n[c]=n[c].indexOf("ms")>-1?parseFloat(n[c]):1e3*parseFloat(n[c]);s&&s!==e||(s="0s"),a=s.split(", ");for(var c=0,h=a.length;c<h;c++)a[c]=a[c].indexOf("ms")>-1?parseFloat(a[c]):1e3*parseFloat(a[c]);for(var c=0,h=n.length;c<h;c++)l[c]=n[c]+a[c];return Math.max.apply(Math,l)}return o(t,"animation")||o(t,"transition")}},{key:"_createItemDom",value:function(t){var e,i,o=this.o,s={},a=n.createDocumentFragment();return s.modal=i=this._createEl("modal"),i[0].tabIndex="-1",i[0].njBox=this,s.modalOuter=e=this._createEl("modalOuter"),o.role&&i.attr("role",o.role),o.label&&i.attr("aria-label",o.label),o.labelledby&&i.attr("aria-labelledby",o.labelledby),o.describedby&&i.attr("aria-describedby",o.describedby),e.append(i),"template"!==t.type&&(s.body=this._createEl("body"),s.bodyInput=(0,u.getItemFromDom)(s.body,"data-njb-body"),t.header&&(s.header=this._createEl("header"),s.headerInput=(0,u.getItemFromDom)(s.header,"data-njb-header"),s.headerInput.length||this._e("njBox, error in o.templates.header")),t.footer&&(s.footer=this._createEl("footer"),s.footerInput=(0,u.getItemFromDom)(s.footer,"data-njb-footer"),s.footerInput.length||this._e("njBox, error in njBox.templates.footer")),"inside"===o.close&&(s.close=this._createEl("close"),s.close.attr("title",this._text.close)),i.append(a)),"image"===t.type?i.addClass("njb--image"):"selector"===t.type?i.addClass("njb--selector"):i.addClass("njb--content"),this._repairItemDom(s),s}},{key:"_repairItemDom",value:function(t){t.modal.append(t.body),t.modal.append(t.close)}},{key:"_type",value:function(e){if("object"===(void 0===e?"undefined":l(e))){if(t.jQuery&&e instanceof t.jQuery||t.j&&e instanceof t.j)return"selector"}else{if(/^[#.]\w/.test(e))return"selector";if(/\.(png|jpg|jpeg|gif|tiff|bmp|webp)(\?\S*)?$/i.test(e))return"image"}return"html"}},{key:"_insertItemContent",value:function(t){function e(){a.headerInput&&(a.headerInput.html(n.header),a.modal.prepend(a.header)),a.footerInput&&(a.footerInput.html(n.footer),a.modal.append(a.footer)),n.state.status="loaded",i._cb("item_loaded",n),"inited"!==i.state.status&&i.items&&i._getActive()===n&&(i._cb("item_ready",n),o.delayed&&i.position())}var i=this,o=i.o,n=t.item,s=t.delayed,a=n.dom,r=n.type,l=n.content,c=a.bodyInput;if("template"===r)a.modal.html(l);else switch(r){case"html":c.html(l),e();break;case"text":c.text(l),e();break;case"selector":s||n.state.contentInserted||this._insertSelector(n,e);break;case"image":s||n.state.contentInserted||this._insertImage(n,e)}}},{key:"_insertSelector",value:function(t,e){var i=t.state.contentEl=d(t.content),o=t.dom.bodyInput;i.length?(t.state.contentElStyle=i[0].style.cssText,t.state.contentElDisplayNone="none"===i.css("display"),t.state.contentElDisplayNone&&(i[0].style.display="block"),o.html(""),o.append(i),t.state.contentInserted=!0):o.html(t.content),e()}},{key:"_insertImage",value:function(t,e){function i(){a._cb("item_img_true",t),a._preloader("hide",t),c.attr("width","auto"),t.dom.bodyInput.append(l),t.state.contentInserted=!0,e()}var o,s,a=this,r=this.o,l=n.createElement("img"),c=d(l);"loading"!==t.state.status&&(t.state.status="loading",t.dom.img=c,t._handlerError=function(){c.off("error",t._handlerError).off("abort",t._handlerError),delete t._handlerError,a._preloader("hide",t),t.dom.bodyInput.html(a._text.imageError.replace("%url%",t.content)),t.dom.modal.removeClass("njb--"+t.type),a._cb("img_e",t),t.state.status="error",t.state.contentInserted=!0},c.on("error",t._handlerError).on("abort",t._handlerError),l.src=t.content,o=l.width+l.height>0,s=l.complete&&l.width+l.height>0,"ready"===r.img&&o||"load"===r.img&&s?i():(this._preloader("show",t),function(t,e){var i,o=0;!function n(s){i&&clearInterval(i),i=setInterval(function(){if(t.width>0)return e(),void clearInterval(i);o>200&&clearInterval(i),o++,5===o?n(10):40===o?n(50):100===o&&n(500)},s)}(1)}(l,function(){a._cb("item_img_ready",t),"ready"===r.img&&i()}),t._handlerLoad=function(){c.off("load",t._handlerLoad),a._cb("item_img_load",t),"load"===r.img&&i()},c.on("load",t._handlerLoad)))}},{key:"_preloader",value:function(t,e){switch(this.o,t){case"show":e.state.preloader=!0,e.dom.preloader=this._createEl("preloader").attr("title",this._text.preloader),e.dom.modal.addClass("njb--loading"),e.dom.modal.html(""),e.dom.modal.append(e.dom.preloader);break;case"hide":if(!e.state.preloader)return;e.dom.preloader[0].parentElement.removeChild(e.dom.preloader[0]),e.dom.modal.removeClass("njb--loading"),delete e.dom.preloader,delete e.state.preloader,this._repairItemDom(e.dom)}}},{key:"_addClickHandler",value:function(){var t=this.o,e=this._handlers;this._removeClickHandler(),t.click&&(e.elsClick=this._clickHandler(),this._g.els&&this._g.els.length&&this._g.els.on("click",e.elsClick),t.clickels&&d(t.clickels).on("click",e.elsClick))}},{key:"_clickHandler",value:function(){var t=(this.o,this);return function(e){var i=this;e.originalEvent&&(e=e.originalEvent),"which"in e&&(1!==e.which||1===e.which&&e.ctrlKey&&e.shiftKey)||d(i).closest(".njb-close-system, .njb-arrow").length||(t.state.clickedEvent=e,t.state.clickedEl=i,t.state.focused=i,t.show())}}},{key:"_removeClickHandler",value:function(){var t=this.o;this._g.els&&this._g.els.length&&(this._g.els.off("click",this._handlers.elsClick),t.clickels&&d(t.clickels).off("click",this._handlers.elsClick))}},{key:"_addListeners",value:function(){var t=this.o,e=this,o=this._handlers;o.container_resize=function(t){e.position()},o.container_scroll=function(t){e.position()},o.container_out=function(o){e.state.clickedEl&&e.state.clickedEl===o.target||"shown"!==e.state.status||d(o.target).closest(".njb, .njb-ui").length||(o.preventDefault?o.preventDefault():o.returnValue=!1,t.out?e.hide():(e._getActive().dom.modal.addClass("njb--pulse"),e._set_focus(e.items[e.state.active]),i(function(){e._getActive().dom.modal.removeClass("njb--pulse")},e._getAnimTime(e._getActive().dom.modal))))},e.dom.container.on("resize",o.container_resize).on("scroll",o.container_scroll),e.dom.document.on("click",o.container_out),o.wrap_resize=function(){e.position()},o.wrap_scroll=function(){e.position()},o.wrap_keydown=function(i){switch(e._cb("keydown",i),i.which){case 27:t.esc&&e.hide(),i.preventDefault?i.preventDefault():i.returnValue=!1}},o.wrap_close=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,e.hide()},o.wrap_ok=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,e.returnValue=e._getReturnValue(),!1!==e._cb("ok",e.returnValue)&&(e.state.okCb=!0,e.hide())},o.wrap_cancel=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,e.returnValue=e._getReturnValue(),e._cb("cancel",e.returnValue),e.state.cancelCb=!0,e.hide()},e.dom.wrap.on("resize",o.wrap_resize).on("scroll",o.wrap_scroll).on("keydown",o.wrap_keydown).delegate("[data-njb-close]","click",o.wrap_close).delegate("[data-njb-ok]","click",o.wrap_ok).delegate("[data-njb-cancel]","click",o.wrap_cancel),o.window_resize=function(){e.position()},o.window_scroll=function(){e.position()},o.window_orientation=function(){e.position()},e.dom.window.on("resize",o.window_resize).on("scroll",o.window_scroll).on("orientationchange",o.window_orientation),o.focusCatchBefore=function(t){var i,o=t.relatedTarget;o?(i=!!d(o).closest(".njb-ui").length,i?e._set_focus(e.items[e.state.active]):e._set_focus(e.items[e.state.active],!0)):e._set_focus(e.items[e.state.active],!0)},o.focusCatchAfter=function(t){e._set_focus(e.items[e.state.active])},this.dom.focusCatchBefore.on("focus",o.focusCatchBefore),this.dom.focusCatchAfter.on("focus",o.focusCatchAfter),this._cb("listeners_added")}},{key:"_getReturnValue",value:function(){var t=this._getActive().dom.modal,e=t.find("[data-njb-return]"),i=void 0;return e.length&&(i=e[0].value||""),i}},{key:"_removeListeners",value:function(){var t=this._handlers,e=this;e.dom.document.off("click",t.container_out),delete t.container_out,e.dom.container.off("resize",t.container_resize).off("scroll",t.container_scroll),delete t.container_resize,delete t.container_scroll,e.dom.wrap.off("resize",t.wrap_resize).off("scroll",t.wrap_scroll).off("keydown",t.wrap_keydown).undelegate("[data-njb-close]","click",t.wrap_close).undelegate("[data-njb-ok]","click",t.wrap_ok).undelegate("[data-njb-cancel]","click",t.wrap_cancel),delete t.wrap_resize,delete t.wrap_scroll,delete t.wrap_keydown,delete t.wrap_close,delete t.wrap_ok,delete t.wrap_cancel,e.dom.window.off("resize",t.window_resize).off("scroll",t.window_scroll).off("orientationchange",t.window_orientation),delete t.window_resize,delete t.window_scroll,delete t.window_orientation,e.dom.focusCatchBefore.off("focus",t.focusCatchBefore),e.dom.focusCatchAfter.off("focus",t.focusCatchAfter),delete t.focusCatchBefore,delete t.focusCatchAfter,this._cb("listeners_removed")}},{key:"_scrollbar",value:function(t){switch(this.o,t){case"hide":if(this.state.scrollbarHidden)return;if(this._g.containerIsBody){var i=(n.documentElement.scrollHeight||n.body.scrollHeight)>n.documentElement.clientHeight;this.dom.container[0].njb_scrollbar||this.state.scrollbarHidden||!i&&"scroll"!==this.dom.html.css("overflowY")&&"scroll"!==this.dom.body.css("overflowY")||(this.dom.html.addClass("njb-hideScrollbar"),this.dom.html.css("paddingRight",parseInt(this.dom.html.css("paddingRight"))+f.g.scrollbarSize+"px"))}else{var i=this.dom.container[0].scrollHeight>this.dom.container[0].clientHeight;this.dom.container.addClass("njb-hideScrollbar")}this.state.scrollbarHidden=!0,this.dom.container[0].njb_scrollbar?this.dom.container[0].njb_scrollbar++:this.dom.container[0].njb_scrollbar=1;break;case"show":if(!this.state.scrollbarHidden)return;if(--this.dom.container[0].njb_scrollbar)return void delete this.state.scrollbarHidden;if(this.dom.container[0].njb_scrollbar=e,this._g.containerIsBody){this.dom.html.removeClass("njb-hideScrollbar");var o=parseInt(this.dom.html.css("paddingRight"))-f.g.scrollbarSize;o?this.dom.html.css("paddingRight",o+"px"):this.dom.html[0].style.paddingRight=""}else{this.dom.container.removeClass("njb-hideScrollbar");var o=parseInt(this.dom.container.css("paddingRight"))-f.g.scrollbarSize;o?this.dom.container.css("paddingRight",o+"px"):this.dom.container[0].style.paddingRight=""}delete this.state.scrollbarHidden}}},{key:"_backdrop",value:function(t){var e=this.o,o=this;switch(t){case"show":if(this.dom.backdrop=this._createEl("backdrop"),this.state.backdropVisible)return;e.backdropassist&&this.dom.backdrop.css("transitionDuration",this._g.animation.showDur+"ms"),"absolute"===e.layout&&this.dom.backdrop.addClass("njb-absolute"),this.dom.container.append(this.dom.backdrop),i(function(){o.dom.backdrop.addClass("njb-backdrop--visible")},0),this.state.backdropVisible=!0;break;case"hide":if(!this.state.backdropVisible)return;e.backdropassist&&this.dom.backdrop.css("transitionDuration",this._g.animation.hideDur+"ms"),this.dom.backdrop.removeClass("njb-backdrop--visible"),i(function(){o.dom.backdrop[0].parentNode.removeChild(o.dom.backdrop[0]),e.backdropassist&&(o.dom.backdrop[0].style.cssText=""),delete o.state.backdropVisible},o._getAnimTime(o.dom.backdrop[0]))}}},{key:"_uiUpdate",value:function(){var t=arguments.length>0&&arguments[0]!==e?arguments[0]:this.state.active,i=this.dom,o=(this.o,this.items[t]);if(!o)return void this._e("njBox, can't update ui info from item index - "+t);o.title?i.ui.addClass("njb-ui--title"):i.ui.removeClass("njb-ui--title"),i.wrap.find("[data-njb-title]").html(o.title||""),"image"===o.type?i.wrap.removeClass("njb-wrap--content").addClass("njb-wrap--image"):i.wrap.removeClass("njb-wrap--image").addClass("njb-wrap--content")}},{key:"_drawItem",value:function(t){var e=this.o,i=t.item,o=t.container,n=t.prepend,s=i.toInsert;i.state.contentInserted||!e.delayed||"image"!==i.type&&"selector"!==i.type||this._insertItemContent({item:i,delayed:!1}),n?o.prepend(s):o.append(s),this._cb("item_inserted",i),"loaded"===i.state.status&&this._cb("item_ready",i)}},{key:"_set_focus",value:function(t,e){var i,o,n=this.o;return n.autofocus?e?(i=this.dom.ui.find(this.o._focusable),void i[i.length-1].focus()):(n.autofocus&&(o=t.dom.modal.find(n.autofocus)[0]),o||(o=t.dom.modal.find("[autofocus]")[0]),o||(i=t.dom.modal.find(this.o._focusable),o=i[0]),void(o?o.focus():t.dom.modal[0].focus())):void this.dom.wrap[0].focus()}},{key:"_removeSelectorItemsElement",value:function(){for(var t,i,o=this.items,n=0,s=o.length;n<s;n++)if("selector"===o[n].type&&this.o.delayed){if(t=o[n],!t.state.contentInserted)continue;i=t.state.contentEl,t.state.contentElDisplayNone&&(i[0].style.display="none",t.state.contentElDisplayNone=e),t.state.contentElStyle&&(i[0].style.cssText=t.state.contentElStyle,t.state.contentElStyle=e),this.dom.body.append(i),t.state.contentInserted=!1}}},{key:"_getDimensions",value:function(){var t=this.o,e={};return e.window=this._getDomSize(this.dom.window),e.container=this._getDomSize(this._g.containerIsBody?this.dom.window:this.dom.container),this.state.clickedEl&&(e.clickedEl=this._getDomSize(this.state.clickedEl)),t.$elem&&1===t.$elem.length&&(e.el=this._getDomSize(t.$elem)),e}},{key:"_getDomSize",value:function(e){e=d(e)[0];var i,o,s=d.isWindow(e),a=n,r=a.documentElement,l=a.body;return s?o={el:e,left:0,top:0,right:r.clientWidth,bottom:r.clientHeight,width:r.clientWidth,height:r.clientHeight,scrollWidth:Math.max(l.scrollWidth,r.scrollWidth,l.offsetWidth,r.offsetWidth,l.clientWidth,r.clientWidth),scrollHeight:Math.max(l.scrollHeight,r.scrollHeight,l.offsetHeight,r.offsetHeight,l.clientHeight,r.clientHeight),scrollLeft:t.pageXOffset||r.scrollLeft||l.scrollLeft||0,scrollTop:t.pageYOffset||r.scrollTop||l.scrollTop||0}:(i=e.getBoundingClientRect(),o={el:e,left:i.left,top:i.top,right:i.right,bottom:i.bottom},o.width=o.right-o.left,o.height=o.bottom-o.top,o.scrollWidth=e.scrollWidth,o.scrollHeight=e.scrollHeight,o.scrollLeft=e.scrollLeft||0,o.scrollTop=e.scrollTop||0),o.scrollLeftMax=o.scrollWidth-o.width<0?0:o.scrollWidth-o.width,o.scrollTopMax=o.scrollHeight-o.height<0?0:o.scrollHeight-o.height,o}},{key:"_setMaxHeight",value:function(t){function e(t,e){return parseInt(t.css(e+"Top"))+parseInt(t.css(e+"Bottom"))||0}var i=this.o,o=this.state.dimensions,n=void 0,s=void 0;if(i.autoheight&&("image"!==i.autoheight||"image"===t.type)){var a=t.dom,r=e(a.modal,"margin"),l=e(a.modal,"padding")+parseInt(a.modal.css("borderTopWidth"))+parseInt(a.modal.css("borderBottomWidth"))||0,c=e(a.body,"margin"),d=e(a.body,"padding")+parseInt(a.body.css("borderTopWidth"))+parseInt(a.body.css("borderBottomWidth"))||0,h=this._g.containerIsBody?o.window.height:o.container.height;n=h,s="border-box"===a.body.css("boxSizing");var u=0,f=0;if(a.header&&a.header.length&&(u=a.header[0].scrollHeight+(parseInt(a.header.css("borderTopWidth"))+parseInt(a.header.css("borderBottomWidth")))||0),a.footer&&a.footer.length&&(f=a.footer[0].scrollHeight+(parseInt(a.footer.css("borderTopWidth"))+parseInt(a.footer.css("borderBottomWidth")))||0),n=h-r-l-c-u-f,s||(n-=d),"image"===t.type){var m=h-r-l-c-d-u-f;a.img&&a.img.css("maxHeight",m+"px")}else a.body.css("maxHeight",n+"px")}}},{key:"_getPassedOption",value:function(t){return this._g.optionsGathered&&this._g.optionsGathered[t]!==e?this._g.optionsGathered[t]:this._g.optionsPassed[t]&&this._g.optionsPassed[t]!==e?this._g.optionsPassed[t]:void 0}},{key:"_focusPreviousModal",value:function(){var t,e=this.dom.body.find(".njb-wrap");e.length&&(t=e[e.length-1].njBox,t._set_focus(t.items[t.state.active]))}}]),f}(h.default);return f.defaults=u.defaults,f.templates=u.templates,f.text=u.text,n.body&&!f.g&&(f.g=(0,u.getDefaultInfo)()),f.addons={},f.addAddon=function(t,e){var i=e.options,o=e.templates,n=e.text,s=e.prototype;this.addons[t]=e,i&&d.extend(this.defaults,i),o&&d.extend(this.templates,o),n&&d.extend(this.text,n),s&&d.extend(this.prototype,s)},f.get=function(t){var i=d(t)[0];return i&&i.njBox||e},f.autobind=function(t){d(t).each(function(){new f({elem:d(this)})})},void 0!==t&&d(function(){f.autobind(f.defaults.autobind)}),f}(window,void 0,setTimeout,document);e.default=p,t.exports=e.default},function(t,e){},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),s=function(){function t(e){if(o(this,t),!arguments.length)return void console.error("njBox, arguments not passed.");var i=void 0,n=this;i=e||{},n.co=i,setTimeout(function(){n._init()},0)}return n(t,[{key:"_init",value:function(){if(!this.state||!this.state.inited){this._cb("init");var t=this.co;return delete this.co,this.state={active:0,arguments:{}},this._g={optionsPassed:t},this.o=t,this._cb("options_set"),this._cb("options_setted",this.o),this.o.elem||this.o.content?(this.dom={},this._cb("dom_create"),this._cb("dom_created",this.dom),this._g.rawItems=[this.o],this._cb("items_gather"),this._cb("items_gathered",this._g.rawItems),this.items=this._createItems(this._g.rawItems),this._cb("items_created",this.items),this.items.length?(this.state.inited=!0,this._cb("inited"),this):void this._e("njBox, smth goes wrong, plugin don't create any item to show",!0)):void this._e("njBox, no elements (o.elem) or content (o.content) for modal.")}}},{key:"show",value:function(){return this._init(),this.state.arguments.show=arguments,"hide"===this.state.status&&(clearTimeout(this._g.hiddenCb),this._hiddenCb()),"inited"!==this.state.status?void this._e("njBox, show, plugin not inited or in not inited state(probably plugin is already visible or destroyed, or smth else..)"):!1!==this._cb("show")?(this._cb("show_prepare"),this._cb("animation_show"),this):void 0}},{key:"hide",value:function(){return this.state.arguments.hide=arguments,"show"===this.state.status&&(clearTimeout(this._g.shownCb),this._shownCb()),"shown"!==this.state.status?void this._e("njBox, hide, we can hide only shown modal (probably animation is still running or plugin destroyed)."):!1!==this._cb("hide")?(this._cb("hide_prepare"),this._cb("animation_hide"),this):void 0}},{key:"position",value:function(){if(this.state.arguments.position=arguments,this.state&&this.state.inited&&("show"===this.state.status||"shown"===this.state.status))return this._cb("position"),this._cb("positioned"),this}},{key:"destroy",value:function(){return this.state.arguments.destroy=arguments,this.state.inited&&"inited"===this.state.status?(this._cb("destroy"),this._cb("destroyed"),this._events=this.o=this.state=this._g=this.items=this.dom={},this):void this._e("njBox, we can destroy only initialized && hidden modals.")}},{key:"_createItems",value:function(t){for(var e=[],i=0,o=t.length;i<o;i++)e.push(this._createItem(t[i],i));return e}},{key:"_createItem",value:function(t,e){var i=(this.o,this._normalizeItem(t));return this._cb("item_create",i,e),this._cb("item_created",i,e),i}},{key:"_normalizeItem",value:function(t,e){var i;i="function"==typeof t.content?t.content.call(this,t):t.content;var o={content:i,type:t.type,header:t.header,footer:t.footer,title:t.title,state:{status:"inited"},raw:t};return this._cb("item_normalized",o,t),o}},{key:"_getActive",value:function(){return this.items[this.state.active]}},{key:"_shownCb",value:function(){this._cb("shown")}},{key:"_hiddenCb",value:function(){this._clear(),this._cb("hidden"),this.state.status="inited"}},{key:"_clear",value:function(){this.o,this._cb("clear"),this.state={active:0,arguments:{},inited:!0}}},{key:"_e",value:function(t,e){t&&(console.error(t),e&&this._clear())}},{key:"_cb",value:function(t){var e,i=this.o;"inited"!==t&&"show"!==t&&"shown"!==t&&"hide"!==t&&"hidden"!==t&&"destroy"!==t||(this.state.status=t),this.trigger.apply(this,arguments);var o=Array.prototype.slice.call(arguments);this.trigger.apply(this,["cb"].concat(o)),i&&i.oncb&&"function"==typeof i.oncb&&(e=i.oncb.apply(this,o));var n=Array.prototype.slice.call(arguments,1);return i&&"function"==typeof i["on"+t]&&(e=i["on"+t].apply(this,n)),"show"===t&&!1===e?this.state.status="inited":"hide"===t&&!1===e&&(this.state.status="shown"),e}},{key:"on",value:function(t,e){return this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e),this}},{key:"off",value:function(t,e){if(this._events=this._events||{},t in this._events!=0)return this._events[t].splice(this._events[t].indexOf(e),1),this}},{key:"trigger",value:function(t){if(this._events=this._events||{},t in this._events!=0){for(var e=0;e<this._events[t].length;e++)"function"==typeof this._events[t][e]&&this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1));return this}}}]),t}();e.default=s,t.exports=e.default},function(t,e,i){"use strict";function o(){function t(t){var i,o,n,s=["Webkit","Moz","O","ms"],a=t.charAt(0).toUpperCase()+t.slice(1),r=document.createElement("div");if(document.body.insertBefore(r,null),t in r.style)o=t,n=null;else for(var l=0;l<s.length;l++){if((i=s[l]+a)in r.style){n=s[l];break}i=void 0}var c={js:o||i,css:e(t,n)};if("transform"===t){if(void 0!==r.style[c.js]){r.style[c.js]="translate3d(1px,1px,1px)";var d=window.getComputedStyle(r)[c.js]}c["3d"]=void 0!==d&&d.length>0&&"none"!==d}return document.body.removeChild(r),c}function e(t,e){if(t=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),null===e)return t;var i=void 0;switch(e){case"Webkit":i="-webkit-"+t;break;case"Moz":i="-moz-"+t;break;case"ms":i="-ms-"+t;break;case"O":i="-o-"+t}return i}var i={},o=document.createElement("div");o.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -99px;",document.body.appendChild(o),i.scrollbarSize=o.offsetWidth-o.clientWidth||0,document.body.removeChild(o),i.oldIE=!(!document.all||document.addEventListener),i.touch="ontouchstart"in window;var n=i;return n.nativeDialogSupport=!!document.createElement("dialog").showModal,n.transition=t("transition"),n.transitionDuration=t("transitionDuration"),n.transform=t("transform"),n.animation=t("animation"),i}function n(t,e){return null!==t.attr(e)?t:t.find("["+e+"]")}Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaultInfo=o,e.getItemFromDom=n,e.defaults={elem:"",content:void 0,delayed:!0,type:void 0,header:void 0,footer:void 0,class:!1,zindex:!1,container:"body",layout:"fixed",click:!0,clickels:!1,backdrop:!0,backdropassist:!0,scrollbar:"hide",out:!0,esc:!0,close:"outside",autoheight:"image",autofocus:!0,focusprevious:!0,title:void 0,titleattr:"title",img:"ready",anim:"scale",animclass:"",duration:"auto",jquery:void 0,//!!! jQuery NOT required for plugin, plugin can work with it to support old browsers !!! link to jquery (for modules without global scope) P.S. Plugin will try to found jquery in global namespace even without this option.
autobind:'[data-toggle~="box"], [data-toggle~="modal"]',_focusable:'a[href], area[href], details, iframe, object, embed, input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"]), [contenteditable]',buttonrole:"button",role:"dialog",label:!1,labelledby:!1,describedby:!1},e.templates={wrap:'<div class="njb-wrap"><div class="njb-items"></div></div>',backdrop:'<div class="njb-backdrop"></div>',modalOuter:'<div class="njb-outer"></div>',modal:'<div class="njb"></div>',body:'<div class="njb__body" data-njb-body></div>',header:'<header class="njb__header" data-njb-header></header>',footer:'<footer class="njb__footer" data-njb-footer></footer>',close:'<button type="button" class="njb-ui__close" data-njb-close><span aria-hidden="true">×</span></button>',focusCatcher:'<span tabindex="0" class="njb-focus-catch" aria-hidden="true"></span>',preloader:'<div class="njb-preloader"><div class="njb-preloader__inner"><div class="njb-preloader__bar1"></div><div class="njb-preloader__bar2"></div><div class="njb-preloader__bar3"></div></div></div>',ui:'<div class="njb-ui"></div>',title:'<div class="njb-ui__title"><div class="njb-ui__title-inner" id="njb-title" data-njb-title></div></div>'},e.text={_missedContent:"njBox plugin: meow, put some content here...",preloader:"Loading...",imageError:'<a href="%url%">This image</a> can not be loaded.',close:"Close dialog",ok:"Ok",cancel:"Cancel",placeholder:""}},function(t,e,i){"use strict";function o(t,e){var i=s(t),o=document.createDocumentFragment();return i.each(function(){o.appendChild(this)}),this.each(function(){"append"===e?this.appendChild(o):this.insertBefore(o,this.firstChild)})}Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function t(e){return new t.fn.init(e||"")};s.match=function(t,e){return t===document&&(t=document.documentElement),(t.matches||t.matchesSelector||t.oMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.msMatchesSelector).call(t,e)},s.extend=function(){return Object.assign.apply(Object,Array.prototype.slice.call(arguments))},s.isPlainObject=function(t){return"object"===(void 0===t?"undefined":n(t))&&null!==t&&t.constructor===Object&&"[object Object]"===Object.prototype.toString.call(t)},s.isWindow=function(t){return null!=t&&t==t.window},s.fn=s.prototype,s.fn.init=function(t){var e;"string"==typeof t&&t.length>0?e="<"===t.charAt(0)?s.str2dom?s.str2dom(t):[]:document.querySelectorAll(t):t instanceof Array||t instanceof NodeList||t instanceof HTMLCollection||t instanceof s?e=t:t.nodeType||window.Node&&t instanceof Node||t==t.window||"object"===(void 0===t?"undefined":n(t))?e=[t]:"function"==typeof t?(e=[document],document.addEventListener("DOMContentLoaded",t)):e=[],this.length=e.length;for(var i=0,o=this.length;i<o;i++)this[i]=e[i];return this},s.fn.init.prototype=s.fn,s.fn.each=function(t){for(var e=0,i=this.length;e<i&&!1!==t.call(this[e],e,this[e]);e++);return this},s.str2dom=function(t){var e=document.createElement("div");return e.innerHTML=t,e.childNodes},s.inArray=function(t,e,i){return null==e?-1:e.indexOf(t,i)},s.fn.find=function(t){var e,i=[];return this.each(function(o){e=Array.prototype.slice.call(this.querySelectorAll(t),""),e.length&&(i=i.concat(e))}),s(i)},s.fn.on=function(t,e){return this.each(function(){this.addEventListener(t,e,!1)})},s.fn.off=function(t,e){return this.each(function(){this.removeEventListener(t,e)})},s.fn.delegate=function(t,e,i){return this.each(function(o){var n=this;this._events||(this._events={}),this._events[e]||(this._events[e]=[]);var a=function(e){var o=e&&e.target||window.event.srcElement,a=e.path;if(!a){a=[];for(var r=o;r;)a.push(r),r=r.parentNode}for(var l=0,c=a.length;l<c&&a[l]!==n;l++)if(a[l]!==document&&s.match(a[l],t)){i.call(a[l],e);break}};a.fn=i,this.addEventListener(e,a,!1),this._events[e].push(a)})},s.fn.undelegate=function(t,e,i){return i||(i=e,e=t),this.each(function(t){var o=this._events,n=this._events[e];if(o&&n){for(var t=0,s=n.length;t<s;t++)if(i===n[t].fn){this.removeEventListener(e,n[t]),delete n[t].fn,n.splice(t,1);break}n.length||delete o[e];var a=!0;for(var r in o)if(o.hasOwnProperty(r)){a=!1;break}a&&delete this._events}})},s.fn.data=function(t){return t?this[0].dataset[t]:this[0].dataset},s.fn.attr=function(t,e){return void 0!==e?this.each(function(){this.setAttribute(t,e)}):this[0].getAttribute(t)},s.parseJSON=function(t){return JSON.parse(t)},s.fn.css=function(t,e){if(t)return"float"==t&&(t="styleFloat"),e?this.each(function(){this.style[t]=e}):getComputedStyle(this[0],null)[t]||void 0},s.fn.hasClass=function(t){return this[0].classList.contains(t)},s.fn.addClass=function(t){var e=t.split(" ");return this.each(function(){for(var t=0,i=e.length;t<i;t++)this.classList.add(e[t])})},s.fn.removeClass=function(t){var e=t.split(" ");return this.each(function(t){for(var t=0,i=e.length;t<i;t++)this.classList.remove(e[t])})},s.fn.closest=function(t){for(var e,i=[],o=0,n=this.length;o<n;o++)if(s.match(this[o],t))i.push(this[o]);else for((e=this[o].parentNode)===document&&(e=document.documentElement);e&&"HTML"!==e.tagName;)s.match(e,t)&&-1===s.inArray(e,i)&&i.push(e),e=e.parentNode;return s(i)},s.fn.html=function(t){return this.each(function(){this.innerHTML=t})},s.fn.text=function(t){return this.each(function(){this.textContent=t})},s.fn.append=function(t){return o.call(this,t,"append")},s.fn.prepend=function(t){return o.call(this,t,"prepend")},e.default=s,t.exports=e.default}])});